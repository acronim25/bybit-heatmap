/* ============================================
   3D METALLIC BUBBLE SYSTEM
   Ralph-1: Bubbles Visual System
   
   Creates flowing metallic ribbons with neon
   glow edges that respond to price changes
   ============================================ */

/* ===== CSS Variables for Bubble System ===== */
:root {
  --bubble-size-base: 60px;
  --bubble-glow-intensity: 1;
  --metallic-shine: 0.8;
  
  /* Metallic ribbon colors - purple/pink glow base */
  --metal-primary: #ff00ff;
  --metal-secondary: #ff1493;
  --metal-highlight: #ffffff;
  --metal-shadow: #4a004a;
  
  /* Dynamic colors - interpolated based on price change */
  --bubble-up-primary: #00ff41;
  --bubble-up-secondary: #39ff14;
  --bubble-up-glow: rgba(0, 255, 65, 0.6);
  
  --bubble-down-primary: #ff0040;
  --bubble-down-secondary: #ff1744;
  --bubble-down-glow: rgba(255, 0, 64, 0.6);
  
  /* Neutral/mid color for near-zero changes */
  --bubble-neutral-primary: #ffd700;
  --bubble-neutral-secondary: #ffa500;
  --bubble-neutral-glow: rgba(255, 215, 0, 0.5);
}

/* ===== 3D Bubble Container ===== */
.bubble-3d-container {
  perspective: 1000px;
  transform-style: preserve-3d;
}

/* ===== Metallic Ribbon Bubble ===== */
.metallic-bubble {
  position: relative;
  width: var(--bubble-size);
  height: var(--bubble-size);
  transform-style: preserve-3d;
  cursor: pointer;
  transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.metallic-bubble:hover {
  transform: scale(1.15) rotateY(15deg) rotateX(-10deg);
}

.metallic-bubble.expanded {
  animation: bubbleExpand 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.metallic-bubble.spinning {
  animation: bubbleSpin 1.2s ease-in-out;
}

/* ===== SVG Ribbon Styling ===== */
.bubble-ribbon-svg {
  width: 100%;
  height: 100%;
  overflow: visible;
  filter: drop-shadow(0 0 20px var(--ribbon-glow, rgba(255, 0, 255, 0.5)));
  transition: filter 0.4s ease;
}

.metallic-bubble:hover .bubble-ribbon-svg {
  filter: drop-shadow(0 0 35px var(--ribbon-glow, rgba(255, 0, 255, 0.8))) 
          drop-shadow(0 0 60px var(--ribbon-glow-secondary, rgba(255, 20, 147, 0.4)));
}

/* Ribbon paths with metallic gradient */
.ribbon-path {
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: all 0.5s ease;
}

.ribbon-path.outer {
  stroke-width: 14;
  opacity: 0.9;
}

.ribbon-path.middle {
  stroke-width: 8;
  opacity: 0.95;
}

.ribbon-path.inner {
  stroke-width: 4;
  opacity: 1;
}

.ribbon-path.highlight {
  stroke-width: 2;
  opacity: 0.8;
  filter: blur(1px);
}

/* ===== Metallic Gradients ===== */
.metal-gradient-defs {
  position: absolute;
  width: 0;
  height: 0;
}

/* Dynamic metallic gradient based on price change */
.metal-surface-up {
  --metal-base: var(--bubble-up-primary);
  --metal-mid: var(--bubble-up-secondary);
  --metal-glow: var(--bubble-up-glow);
}

.metal-surface-down {
  --metal-base: var(--bubble-down-primary);
  --metal-mid: var(--bubble-down-secondary);
  --metal-glow: var(--bubble-down-glow);
}

.metal-surface-neutral {
  --metal-base: var(--bubble-neutral-primary);
  --metal-mid: var(--bubble-neutral-secondary);
  --metal-glow: var(--bubble-neutral-glow);
}

/* ===== Neon Glow Effects ===== */
.neon-glow-filter {
  filter: url(#neonGlow);
}

.metallic-glow-filter {
  filter: url(#metallicGlow);
}

/* Box shadow glow for container */
.bubble-glow-container {
  position: absolute;
  inset: -10px;
  border-radius: 50%;
  background: radial-gradient(
    circle at 30% 30%,
    var(--ribbon-glow, rgba(255, 0, 255, 0.3)) 0%,
    transparent 70%
  );
  opacity: 0.6;
  transition: opacity 0.4s ease;
  pointer-events: none;
  z-index: -1;
}

.metallic-bubble:hover .bubble-glow-container {
  opacity: 1;
}

/* ===== Bubble Labels ===== */
.bubble-label-container {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
}

.bubble-symbol {
  font-family: 'Orbitron', sans-serif;
  font-size: calc(var(--bubble-size) * 0.18);
  font-weight: 700;
  letter-spacing: 1px;
  color: #ffffff;
  text-shadow: 
    0 0 10px rgba(0, 0, 0, 0.9),
    0 0 20px var(--ribbon-glow, rgba(255, 0, 255, 0.5)),
    0 0 40px var(--ribbon-glow, rgba(255, 0, 255, 0.3));
  transition: all 0.3s ease;
}

.bubble-change-text {
  font-family: 'Rajdhani', sans-serif;
  font-size: calc(var(--bubble-size) * 0.14);
  font-weight: 600;
  color: #ffffff;
  text-shadow: 
    0 0 8px rgba(0, 0, 0, 0.9),
    0 0 16px var(--ribbon-glow, rgba(255, 0, 255, 0.4));
  margin-top: 2px;
  transition: all 0.3s ease;
}

.metallic-bubble:hover .bubble-symbol {
  transform: scale(1.1);
  text-shadow: 
    0 0 15px rgba(0, 0, 0, 0.9),
    0 0 30px var(--ribbon-glow, rgba(255, 0, 255, 0.8)),
    0 0 60px var(--ribbon-glow, rgba(255, 0, 255, 0.5));
}

/* ===== Keyframe Animations ===== */

/* Spin animation on hover/click */
@keyframes bubbleSpin {
  0% {
    transform: scale(1) rotateZ(0deg) rotateY(0deg);
  }
  25% {
    transform: scale(1.2) rotateZ(90deg) rotateY(45deg);
  }
  50% {
    transform: scale(1.3) rotateZ(180deg) rotateY(90deg);
  }
  75% {
    transform: scale(1.2) rotateZ(270deg) rotateY(45deg);
  }
  100% {
    transform: scale(1) rotateZ(360deg) rotateY(0deg);
  }
}

/* Expand animation for detail view */
@keyframes bubbleExpand {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.5);
  }
  100% {
    transform: scale(1.3);
  }
}

/* Floating animation for idle state */
@keyframes bubbleFloat {
  0%, 100% {
    transform: translateY(0) rotateX(0deg) rotateY(0deg);
  }
  25% {
    transform: translateY(-5px) rotateX(5deg) rotateY(5deg);
  }
  50% {
    transform: translateY(0) rotateX(0deg) rotateY(10deg);
  }
  75% {
    transform: translateY(5px) rotateX(-5deg) rotateY(5deg);
  }
}

.bubble-floating {
  animation: bubbleFloat 6s ease-in-out infinite;
}

/* Pulse glow animation for high volume/activity */
@keyframes bubblePulse {
  0%, 100% {
    filter: drop-shadow(0 0 20px var(--ribbon-glow, rgba(255, 0, 255, 0.5)));
  }
  50% {
    filter: drop-shadow(0 0 40px var(--ribbon-glow, rgba(255, 0, 255, 0.8)))
            drop-shadow(0 0 80px var(--ribbon-glow-secondary, rgba(255, 20, 147, 0.4)));
  }
}

.bubble-pulse {
  animation: bubblePulse 2s ease-in-out infinite;
}

/* Shimmer effect for metallic surface */
@keyframes metalShimmer {
  0% {
    stop-opacity: 0.3;
  }
  50% {
    stop-opacity: 1;
  }
  100% {
    stop-opacity: 0.3;
  }
}

.metal-shimmer-animate {
  animation: metalShimmer 3s ease-in-out infinite;
}

/* Ribbon twist animation */
@keyframes ribbonTwist {
  0% {
    stroke-dashoffset: 0;
  }
  100% {
    stroke-dashoffset: 100;
  }
}

.ribbon-animated {
  stroke-dasharray: 20 10;
  animation: ribbonTwist 10s linear infinite;
}

/* ===== Size Variations ===== */
.bubble-size-xs { --bubble-size: 40px; }
.bubble-size-sm { --bubble-size: 50px; }
.bubble-size-md { --bubble-size: 70px; }
.bubble-size-lg { --bubble-size: 90px; }
.bubble-size-xl { --bubble-size: 120px; }

/* ===== Alert States ===== */
.bubble-alert-high {
  animation: bubblePulse 0.8s ease-in-out infinite;
}

.bubble-alert-medium {
  animation: bubblePulse 1.5s ease-in-out infinite;
}

/* ===== 3D Transform Helpers ===== */
.preserve-3d {
  transform-style: preserve-3d;
}

.backface-hidden {
  backface-visibility: hidden;
}

/* Perspective containers */
.perspective-500 { perspective: 500px; }
.perspective-1000 { perspective: 1000px; }
.perspective-1500 { perspective: 1500px; }

/* ===== SVG Filter Effects ===== */
/* These are defined in SVG but styled here for reference */
svg.filter-defs {
  position: absolute;
  width: 0;
  height: 0;
  overflow: hidden;
}

/* ===== Responsive Adjustments ===== */
@media (max-width: 768px) {
  :root {
    --bubble-size-base: 50px;
  }
  
  .bubble-symbol {
    font-size: calc(var(--bubble-size) * 0.16);
  }
  
  .bubble-change-text {
    font-size: calc(var(--bubble-size) * 0.12);
  }
}

/* ===== Dark/Light Theme Adaptations ===== */
[data-theme="light"] .bubble-symbol,
[data-theme="light"] .bubble-change-text {
  text-shadow: 
    0 0 10px rgba(255, 255, 255, 0.9),
    0 0 20px var(--ribbon-glow, rgba(255, 0, 255, 0.3));
}

[data-theme="light"] .bubble-glow-container {
  opacity: 0.4;
}

[data-theme="light"] .metallic-bubble:hover .bubble-glow-container {
  opacity: 0.8;
}
