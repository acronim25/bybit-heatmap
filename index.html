<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Crypto Diver | Bybit Futures Heatmap</title><script src="https://d3js.org/d3.v7.min.js" defer></script><link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet"><style>
:root{--bg-primary:#050a08;--bg-secondary:#0a1a0f;--text-primary:#fff;--text-secondary:rgba(255,255,255,.7);--text-muted:rgba(255,255,255,.5);--accent-green:#0f0;--accent-red:#f36;--accent-purple:#b829dd;--neon-cyan:#0d4;--glow-green:rgba(0,255,0,.5);--glow-red:rgba(255,51,102,.5);--glow-purple:rgba(184,41,221,.6);--transition-base:.3s ease;--header-height:70px;--filter-bar-height:140px;--bottom-nav-height:64px;--safe-top:env(safe-area-inset-top,0);--safe-bottom:env(safe-area-inset-bottom,0);--z-background:1;--z-divers:5;--z-crypto-icons:50;--z-shapes:100;--z-modal:200;--z-alert:95}
[data-theme=light]{--bg-primary:#f0f5f0;--bg-secondary:#e8f0e8;--text-primary:#1a3a2a;--text-secondary:rgba(26,58,42,.7);--text-muted:rgba(26,58,42,.4);--accent-green:#2a8a4a;--accent-red:#c54a4a;--glow-green:rgba(42,138,74,.3);--glow-red:rgba(197,74,74,.3)}
*,::after,::before{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}body{font-family:Rajdhani,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;overflow-x:hidden;font-size:16px;line-height:1.5}
.filter-system{position:fixed;top:calc(var(--header-height) + var(--safe-top));left:0;right:0;z-index:90;background:linear-gradient(180deg,rgba(10,10,15,.95) 0%,rgba(10,10,15,.85) 60%,transparent 100%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:12px 20px;border-bottom:1px solid rgba(255,255,255,.05)}
[data-theme=light] .filter-system{background:linear-gradient(180deg,rgba(240,245,240,.95) 0%,rgba(240,245,240,.85) 60%,transparent 100%);border-bottom:1px solid rgba(0,0,0,.05)}
.filter-container{display:flex;flex-direction:column;gap:10px;max-width:1400px;margin:0 auto}
.filter-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.filter-row-secondary{display:flex;align-items:center;gap:16px;flex-wrap:wrap;padding-top:4px;border-top:1px solid rgba(255,255,255,.08)}
[data-theme=light] .filter-row-secondary{border-top:1px solid rgba(0,0,0,.08)}
.category-filters{display:flex;gap:8px;flex-wrap:wrap}
.category-btn{padding:8px 16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:20px;color:var(--text-secondary);font-family:Rajdhani,sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .3s cubic-bezier(.34,1.56,.64,1);display:flex;align-items:center;gap:6px;will-change:transform}
.category-btn:hover{background:rgba(255,255,255,.1);transform:translateY(-1px)}
.category-btn.active{background:linear-gradient(135deg,rgba(184,41,221,.3),rgba(255,0,255,.2));border-color:rgba(184,41,221,.5);color:#fff;box-shadow:0 0 20px rgba(184,41,221,.3)}
.category-btn.gainers.active{background:linear-gradient(135deg,rgba(0,255,0,.3),rgba(0,255,0,.15));border-color:rgba(0,255,0,.5);box-shadow:0 0 20px rgba(0,255,0,.3)}
.category-btn.losers.active{background:linear-gradient(135deg,rgba(255,51,102,.3),rgba(255,51,102,.15));border-color:rgba(255,51,102,.5);box-shadow:0 0 20px rgba(255,51,102,.3)}
.sort-controls{display:flex;align-items:center;gap:8px}
.sort-select{padding:8px 32px 8px 14px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:12px;color:var(--text-primary);font-family:Rajdhani,sans-serif;font-size:13px;cursor:pointer;outline:0;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;transition:all .2s ease}
.sort-select:focus{background:rgba(255,255,255,.1);border-color:rgba(184,41,221,.5);box-shadow:0 0 0 3px rgba(184,41,221,.1)}
.sort-direction-btn{width:36px;height:36px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:10px;color:var(--text-secondary);font-size:14px;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;justify-content:center}
.sort-direction-btn:hover{background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2)}
.filter-search{position:relative;flex:1;min-width:200px;max-width:300px}
.filter-search-input{width:100%;padding:10px 16px 10px 40px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:12px;color:var(--text-primary);font-family:Rajdhani,sans-serif;font-size:14px;outline:0;transition:all .2s ease}
.filter-search-input:focus{background:rgba(255,255,255,.1);border-color:rgba(184,41,221,.5);box-shadow:0 0 0 3px rgba(184,41,221,.1)}
.filter-search-input::placeholder{color:var(--text-muted)}
.filter-search-icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text-muted);font-size:14px}
.filter-search-clear{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:20px;height:20px;background:rgba(255,255,255,.1);border:0;border-radius:50%;color:var(--text-muted);font-size:12px;cursor:pointer;opacity:0;visibility:hidden;transition:all .2s ease;display:flex;align-items:center;justify-content:center}
.filter-search-input:not(:placeholder-shown)~.filter-search-clear{opacity:1;visibility:visible}
.volume-filter{display:flex;align-items:center;gap:12px;flex:1;min-width:250px}
.volume-filter-label{font-size:12px;color:var(--text-secondary);white-space:nowrap;font-weight:600}
.volume-slider-wrapper{flex:1;position:relative}
.volume-slider{width:100%;height:6px;-webkit-appearance:none;appearance:none;background:rgba(255,255,255,.1);border-radius:3px;outline:none;cursor:pointer}
.volume-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;background:linear-gradient(135deg,var(--accent-purple),#f0f);border-radius:50%;cursor:pointer;box-shadow:0 0 10px rgba(184,41,221,.5);transition:all .2s ease}
.volume-slider::-webkit-slider-thumb:hover{transform:scale(1.1);box-shadow:0 0 15px rgba(184,41,221,.7)}
.volume-slider::-moz-range-thumb{width:18px;height:18px;background:linear-gradient(135deg,var(--accent-purple),#f0f);border-radius:50%;cursor:pointer;border:none;box-shadow:0 0 10px rgba(184,41,221,.5)}
.volume-value{font-size:12px;color:var(--accent-purple);font-weight:700;min-width:50px;text-align:right;font-family:Orbitron,sans-serif}
.alert-toggle-btn{display:flex;align-items:center;gap:8px;padding:8px 16px;background:rgba(255,204,0,.1);border:1px solid rgba(255,204,0,.3);border-radius:20px;color:#fc0;font-family:Rajdhani,sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .3s ease}
.alert-toggle-btn:hover{background:rgba(255,204,0,.2);box-shadow:0 0 15px rgba(255,204,0,.2)}
.alert-toggle-btn.active{background:rgba(255,204,0,.25);border-color:rgba(255,204,0,.5);box-shadow:0 0 20px rgba(255,204,0,.3)}
.alert-toggle-btn .bell-icon{font-size:14px;animation:none}
.alert-toggle-btn.active .bell-icon{animation:bellRing 2s ease-in-out infinite}
@keyframes bellRing{0%,100%{transform:rotate(0)}5%,15%{transform:rotate(15deg)}10%,20%{transform:rotate(-15deg)}25%{transform:rotate(0)}}
.active-filters{display:flex;align-items:center;gap:8px;flex-wrap:wrap;min-height:28px}
.filter-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;background:linear-gradient(135deg,rgba(0,212,255,.2),rgba(0,212,255,.1));border:1px solid rgba(0,212,255,.3);border-radius:16px;font-size:12px;color:var(--neon-cyan);animation:chipIn .3s cubic-bezier(.34,1.56,.64,1)}
@keyframes chipIn{from{opacity:0;transform:scale(.8) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.filter-chip-remove{width:16px;height:16px;background:rgba(255,255,255,.1);border:0;border-radius:50%;color:inherit;font-size:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}
.filter-chip-remove:hover{background:rgba(255,51,102,.5);color:#fff}
.clear-all-btn{padding:6px 12px;background:rgba(255,51,102,.15);border:1px solid rgba(255,51,102,.3);border-radius:16px;color:var(--accent-red);font-family:Rajdhani,sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s ease}
.clear-all-btn:hover{background:rgba(255,51,102,.25);box-shadow:0 0 15px rgba(255,51,102,.2)}
.results-count{font-size:12px;color:var(--text-muted);margin-left:auto}
.futures-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;background:rgba(0,212,255,.15);border:1px solid rgba(0,212,255,.3);border-radius:10px;font-size:10px;color:#0cf;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.bubble-group.highlighted .bubble-spiral{filter:drop-shadow(0 0 30px currentColor) brightness(1.5);animation:highlightPulse 1.5s ease-in-out infinite}
@keyframes highlightPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.bubble-group.dimmed{opacity:.2;filter:grayscale(.8)}
.alert-banner{position:fixed;top:calc(var(--header-height) + var(--filter-bar-height) - 20px);left:50%;transform:translateX(-50%) translateY(-200%);background:rgba(10,26,15,.95);border:1px solid #fc0;border-radius:12px;padding:12px 20px;display:flex;align-items:center;gap:12px;z-index:var(--z-alert);transition:transform .5s cubic-bezier(.34,1.56,.64,1);box-shadow:0 10px 40px rgba(0,0,0,.4),0 0 30px rgba(255,204,0,.2);min-width:300px;max-width:90vw;backdrop-filter:blur(10px)}
.alert-banner.show{transform:translateX(-50%) translateY(0)}
.alert-banner.volume-spike{border-color:var(--accent-red);box-shadow:0 10px 40px rgba(0,0,0,.4),0 0 30px var(--glow-red)}
.alert-icon{font-size:20px;flex-shrink:0}.alert-content{flex:1}.alert-title{font-family:Orbitron,sans-serif;font-size:12px;font-weight:700;color:#fc0;text-transform:uppercase;letter-spacing:1px;margin-bottom:2px}
.alert-banner.volume-spike .alert-title{color:var(--accent-red)}.alert-text{font-size:13px;color:var(--text-secondary)}
.alert-close{background:0 0;border:0;color:var(--text-muted);cursor:pointer;font-size:18px;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .2s ease;flex-shrink:0}
.alert-close:hover{background:rgba(255,255,255,.1);color:var(--text-primary)}
.bg-system-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;z-index:var(--z-background);pointer-events:none;overflow:hidden}
.bg-layer{position:absolute;inset:0;transition:opacity .5s ease}.bg-layer-dark{background:radial-gradient(ellipse at 30% 80%,rgba(0,50,100,.25) 0%,transparent 50%),radial-gradient(ellipse at 70% 20%,rgba(100,0,100,.15) 0%,transparent 40%),radial-gradient(ellipse at 50% 50%,rgba(0,30,60,.4) 0%,transparent 70%),linear-gradient(180deg,#0a0a1a 0%,#0d1f2d 20%,#051015 50%,#020508 80%,#000 100%);opacity:1}
.bg-layer-light{background:radial-gradient(ellipse at 30% 80%,rgba(0,100,150,.1) 0%,transparent 50%),radial-gradient(ellipse at 70% 20%,rgba(150,0,150,.08) 0%,transparent 40%),linear-gradient(180deg,#f8fafc 0%,#e8f0f0 50%,#d0e0e0 100%);opacity:0}
[data-theme=light] .bg-layer-dark{opacity:0}[data-theme=light] .bg-layer-light{opacity:1}
.bg-particles{position:absolute;inset:0;pointer-events:none}.bg-particle{position:absolute;width:3px;height:3px;border-radius:50%;background:rgba(0,212,255,.4);box-shadow:0 0 8px rgba(0,212,255,.5);will-change:transform,opacity}
#divers-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:var(--z-divers);overflow:visible}
.diver-group{position:absolute;pointer-events:none}.diver-group.bull{left:12%;top:40%;transform:translate(-50%,-50%)}.diver-group.bear{right:12%;top:60%;transform:translate(50%,-50%)}
.diver-circle{position:absolute;border-radius:50%;transform:translate(-50%,-50%);left:50%;top:50%;opacity:1;will-change:transform,opacity}
.diver-circle.bull{background:radial-gradient(circle,rgba(0,255,0,.35) 0%,rgba(0,255,0,.12) 40%,rgba(0,255,0,0) 70%);border:2px solid rgba(0,255,0,.7);box-shadow:0 0 50px rgba(0,255,0,.5),0 0 100px rgba(0,255,0,.25),inset 0 0 50px rgba(0,255,0,.1)}
.diver-circle.bear{background:radial-gradient(circle,rgba(255,51,102,.35) 0%,rgba(255,51,102,.12) 40%,rgba(255,51,102,0) 70%);border:2px solid rgba(255,51,102,.7);box-shadow:0 0 50px rgba(255,51,102,.5),0 0 100px rgba(255,51,102,.25),inset 0 0 50px rgba(255,51,102,.1)}
.diver-group.bull .diver-circle:nth-child(1){width:140px;height:140px;animation:pulse-glow-green 4s ease-in-out infinite}
.diver-group.bull .diver-circle:nth-child(2){width:200px;height:200px;animation:pulse-glow-green 4s ease-in-out infinite .8s}
.diver-group.bull .diver-circle:nth-child(3){width:260px;height:260px;animation:pulse-glow-green 4s ease-in-out infinite 1.6s}
.diver-group.bull .diver-circle:nth-child(4){width:320px;height:320px;animation:pulse-glow-green 4s ease-in-out infinite 2.4s}
.diver-group.bear .diver-circle:nth-child(1){width:120px;height:120px;animation:pulse-glow-red 4s ease-in-out infinite}
.diver-group.bear .diver-circle:nth-child(2){width:170px;height:170px;animation:pulse-glow-red 4s ease-in-out infinite .8s}
.diver-group.bear .diver-circle:nth-child(3){width:220px;height:220px;animation:pulse-glow-red 4s ease-in-out infinite 1.6s}
.diver-group.bear .diver-circle:nth-child(4){width:270px;height:270px;animation:pulse-glow-red 4s ease-in-out infinite 2.4s}
@keyframes pulse-glow-green{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.85}50%{transform:translate(-50%,-50%) scale(1.12);opacity:.55}}
@keyframes pulse-glow-red{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.85}50%{transform:translate(-50%,-50%) scale(1.12);opacity:.55}}
#bubble-container{position:relative;z-index:var(--z-crypto-icons);width:100%;min-height:calc(100vh - var(--header-height) - var(--filter-bar-height) - var(--bottom-nav-height) - 40px)}
#bubble-container svg{width:100%;height:100%;display:block;overflow:visible}.bubble-group{cursor:pointer;transform-style:preserve-3d;perspective:1000px;will-change:transform}
.bubble-spiral{filter:drop-shadow(0 0 10px currentColor);transition:all .4s cubic-bezier(.34,1.56,.64,1);will-change:filter,transform}
.bubble-group:hover .bubble-spiral{filter:drop-shadow(0 0 25px currentColor) brightness(1.3);transform:scale(1.15)}
.bubble-group.spinning .bubble-spiral{animation:bubbleSpin 1s cubic-bezier(.34,1.56,.64,1)}
@keyframes bubbleSpin{0%{transform:scale(1) rotate(0)}50%{transform:scale(1.3) rotate(180deg)}100%{transform:scale(1) rotate(360deg)}}
.bubble-label{font-family:Orbitron,sans-serif;font-size:11px;font-weight:700;text-anchor:middle;pointer-events:none;fill:#fff;text-shadow:0 0 10px rgba(0,0,0,.9),0 0 20px currentColor;letter-spacing:1px}
.bubble-change{font-family:Rajdhani,sans-serif;font-size:10px;font-weight:600;text-anchor:middle;pointer-events:none;fill:#fff;text-shadow:0 0 10px rgba(0,0,0,.9)}
.bubble-pulse{animation:volumePulse 1.5s ease-in-out infinite}
@keyframes volumePulse{0%,100%{filter:drop-shadow(0 0 10px currentColor)}50%{filter:drop-shadow(0 0 30px currentColor) brightness(1.3)}}
#geometric-shapes-container{position:fixed;top:0;left:0;width:100%;height:100%;z-index:var(--z-shapes);pointer-events:none;overflow:hidden}
.geo-shape{position:absolute;pointer-events:auto;cursor:pointer;transition:transform .3s ease,opacity .3s ease;will-change:transform,opacity}
.geo-shape:hover{transform:scale(1.2) rotate(5deg);opacity:.9}.geo-shape.filtered-out{opacity:.05;filter:grayscale(100%);pointer-events:none}
.geo-square{background:0 0;border:2px solid var(--accent-green);box-shadow:0 0 15px var(--glow-green),inset 0 0 15px var(--glow-green)}
.geo-circle{border-radius:50%;background:0 0;border:2px solid var(--accent-red);box-shadow:0 0 15px var(--glow-red),inset 0 0 15px var(--glow-red)}
.geo-triangle{width:0;height:0;border-style:solid;filter:drop-shadow(0 0 8px var(--glow-green))}
.geo-triangle.up{border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:26px solid var(--accent-green)}
.geo-triangle.down{border-left:15px solid transparent;border-right:15px solid transparent;border-top:26px solid var(--accent-purple);border-bottom:none}
.geo-diamond{background:0 0;border:2px solid #fc0;box-shadow:0 0 15px rgba(255,204,0,.4),inset 0 0 15px rgba(255,204,0,.2);transform:rotate(45deg)}
.geo-hexagon{clip-path:polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);background:0 0;border:2px solid #f0f;box-shadow:0 0 15px rgba(255,0,255,.4)}
.geo-shape.float{animation:shapeFloat 6s ease-in-out infinite}.geo-shape.pulse{animation:shapePulse 3s ease-in-out infinite}.geo-shape.rotate{animation:shapeRotate 10s linear infinite}
@keyframes shapeFloat{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-15px) rotate(3deg)}}
@keyframes shapePulse{0%,100%{opacity:.4;transform:scale(1)}50%{opacity:.8;transform:scale(1.1)}}
@keyframes shapeRotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.header{position:fixed;top:0;left:0;right:0;height:var(--header-height);padding:12px 20px;padding-top:calc(12px + var(--safe-top));background:linear-gradient(180deg,rgba(10,10,15,.98) 0%,rgba(10,10,15,.85) 60%,transparent 100%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:100;display:flex;justify-content:space-between;align-items:center}
[data-theme=light] .header{background:linear-gradient(180deg,rgba(240,245,240,.98) 0%,rgba(240,245,240,.85) 60%,transparent 100%)}
.logo{font-family:Orbitron,sans-serif;font-size:1.1rem;font-weight:700;letter-spacing:2px;background:linear-gradient(135deg,var(--accent-purple),#f0f);-webkit-background-clip:text;-webkit-text-fill-color:transparent;display:flex;align-items:center;gap:10px}
.header-right{display:flex;align-items:center;gap:12px}.stats{display:flex;gap:12px}
.stat{padding:8px 16px;background:rgba(10,26,15,.85);border:1px solid rgba(255,255,255,.1);border-radius:10px;text-align:center}
.stat-value{font-family:Orbitron,sans-serif;font-size:18px;font-weight:700}.stat-value.bullish{color:var(--accent-green)}.stat-value.bearish{color:var(--accent-red)}
.stat-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px}
.theme-toggle{width:44px;height:44px;border:1px solid rgba(255,255,255,.1);border-radius:12px;background:rgba(10,26,15,.85);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:20px;transition:var(--transition-base)}
.theme-toggle:hover{border-color:var(--accent-purple);transform:scale(1.05)}
.main-content{position:relative;z-index:var(--z-crypto-icons);padding-top:calc(var(--header-height) + var(--filter-bar-height) + 20px);padding-bottom:calc(var(--bottom-nav-height) + 20px);min-height:100vh}
.enhanced-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:var(--z-modal);display:flex;justify-content:center;align-items:flex-end;opacity:0;visibility:hidden;transition:opacity .4s ease,visibility .4s ease}
.enhanced-modal.active{opacity:1;visibility:visible}
.enhanced-modal-content{background:linear-gradient(165deg,rgba(15,20,25,.98) 0%,rgba(8,12,15,.99) 100%);border-radius:24px 24px 0 0;width:100%;max-width:480px;max-height:85vh;position:relative;transform:translateY(100%) scale(.95);transition:transform .5s cubic-bezier(.34,1.56,.64,1);overflow:hidden;box-shadow:0 -20px 80px rgba(0,0,0,.8),inset 0 1px 0 rgba(255,255,255,.1)}
[data-theme=light] .enhanced-modal-content{background:linear-gradient(165deg,rgba(255,255,255,.98) 0%,rgba(240,245,240,.99) 100%)}
.enhanced-modal.active .enhanced-modal-content{transform:translateY(0) scale(1)}
.enhanced-modal-content::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--accent-green) 0%,var(--accent-red) 100%)}
.modal-swipe-handle{width:100%;padding:12px 0;display:flex;justify-content:center;cursor:grab}.modal-swipe-handle::before{content:'';width:40px;height:4px;background:rgba(255,255,255,.2);border-radius:2px}
.modal-header{padding:0 24px 16px;text-align:center;position:relative}.modal-close-btn{position:absolute;top:0;right:16px;width:32px;height:32px;border:0;background:rgba(255,255,255,.05);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);font-size:20px;transition:all .3s ease}
.modal-close-btn:hover{background:rgba(255,0,64,.2);color:var(--accent-red);transform:rotate(90deg)}
.modal-nav{position:absolute;top:50%;transform:translateY(-50%);width:36px;height:36px;border:1px solid rgba(255,255,255,.1);background:rgba(10,26,15,.85);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);font-size:18px;transition:all .3s ease;opacity:0}
.enhanced-modal-content:hover .modal-nav{opacity:1}.modal-nav:hover{background:var(--bg-secondary);border-color:rgba(0,255,0,.3);color:var(--text-primary)}
.modal-nav.prev{left:12px}.modal-nav.next{right:12px}.modal-nav:disabled{opacity:.3;cursor:not-allowed}
.coin-symbol-large{font-family:Orbitron,sans-serif;font-size:2.5rem;font-weight:900;letter-spacing:3px;background:linear-gradient(180deg,#fff 0%,rgba(255,255,255,.7) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
[data-theme=light] .coin-symbol-large{background:linear-gradient(180deg,var(--text-primary) 0%,rgba(26,58,42,.7) 100%);-webkit-background-clip:text}
.coin-full-name{color:var(--text-secondary);font-size:.85rem;letter-spacing:2px;text-transform:uppercase}
.sparkline-container{padding:0 24px 20px}.sparkline-wrapper{height:60px;background:rgba(0,0,0,.3);border-radius:8px;padding:8px}
.sparkline-svg{width:100%;height:100%;overflow:visible}.sparkline-path{fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}.sparkline-area{stroke:none}
.sparkline-dot{r:3;stroke:#fff;stroke-width:2}@keyframes drawLine{to{stroke-dashoffset:0}}
.price-section{padding:0 24px 20px;text-align:center}.price-display{font-family:Orbitron,sans-serif;font-size:2.8rem;font-weight:700;letter-spacing:-1px;margin-bottom:8px}
.price-change-pill{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:20px;font-family:Orbitron,sans-serif;font-size:1rem;font-weight:600}
.price-change-pill.positive{background:rgba(0,255,0,.15);color:var(--accent-green);box-shadow:0 0 20px var(--glow-green)}
.price-change-pill.negative{background:rgba(255,51,102,.15);color:var(--accent-red);box-shadow:0 0 20px var(--glow-red)}
.modal-stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:0 24px 20px}
.stat-card{background:rgba(10,26,15,.85);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:14px 12px;transition:all .3s ease}
.stat-card:hover{border-color:rgba(0,255,0,.3);transform:translateY(-2px)}
.stat-card-label{font-size:.65rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.stat-card-value{font-family:Orbitron,sans-serif;font-size:.95rem;font-weight:600}.stat-card-value.highlight{font-size:1.1rem}
.hl-progress{margin-top:8px;height:4px;background:rgba(255,255,255,.1);border-radius:2px;overflow:hidden;position:relative}.hl-progress-bar{height:100%;background:linear-gradient(90deg,var(--accent-red),var(--accent-green));border-radius:2px;transition:width .6s cubic-bezier(.34,1.56,.64,1)}
.hl-labels{display:flex;justify-content:space-between;margin-top:4px;font-size:.6rem;color:var(--text-muted)}
.volume-bars{display:flex;align-items:flex-end;gap:2px;height:20px;margin-top:6px}.volume-bar-mini{flex:1;background:linear-gradient(to top,#3cf,rgba(51,204,255,.3));border-radius:1px;min-height:2px}
.modal-actions{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 24px 24px}
.action-btn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px 8px;background:rgba(10,26,15,.85);border:1px solid rgba(255,255,255,.1);border-radius:12px;cursor:pointer;transition:all .3s ease;color:var(--text-secondary)}
.action-btn:hover{background:var(--bg-secondary);border-color:rgba(0,255,0,.3);transform:translateY(-2px);color:var(--text-primary)}
.action-btn.primary{background:linear-gradient(135deg,rgba(0,255,0,.15),rgba(0,212,255,.1));border-color:rgba(0,255,0,.3);color:var(--accent-green)}
.action-btn.primary:hover{box-shadow:0 0 20px var(--glow-green)}.action-icon{font-size:1.3rem}.action-label{font-size:.65rem;text-transform:uppercase;letter-spacing:1px}
.modal-toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(20px);background:rgba(0,0,0,.9);backdrop-filter:blur(10px);padding:12px 24px;border-radius:24px;border:1px solid rgba(255,255,255,.1);color:var(--text-primary);font-size:.85rem;display:flex;align-items:center;gap:8px;opacity:0;visibility:hidden;transition:all .3s ease;z-index:calc(var(--z-modal) + 1)}
.modal-toast.show{opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:var(--bottom-nav-height);padding-bottom:var(--safe-bottom);background:linear-gradient(0deg,rgba(10,10,15,.98) 0%,rgba(10,10,15,.9) 70%,transparent 100%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:100;display:flex;justify-content:space-around;align-items:center;border-top:1px solid rgba(255,255,255,.1)}
[data-theme=light] .bottom-nav{background:linear-gradient(0deg,rgba(240,245,240,.98) 0%,rgba(240,245,240,.9) 70%,transparent 100%)}
.bottom-nav-item{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;min-width:48px;min-height:48px;padding:4px;background:0 0;border:0;color:var(--text-muted);font-family:Rajdhani,sans-serif;font-size:11px;cursor:pointer;transition:all .3s ease}
.bottom-nav-item.active{color:var(--accent-green)}.bottom-nav-icon{font-size:20px;line-height:1}
.loading-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--bg-primary);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;z-index:9999;transition:opacity .5s ease,visibility .5s ease}
.loading-overlay.hidden{opacity:0;visibility:hidden;pointer-events:none}
.loading-spinner{width:60px;height:60px;border:3px solid rgba(255,255,255,.1);border-top-color:var(--accent-purple);border-radius:50%;animation:spin 1s linear infinite}
.loading-text{font-family:Orbitron,sans-serif;font-size:14px;color:var(--text-secondary);letter-spacing:2px}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:768px){:root{--header-height:60px;--filter-bar-height:160px}.logo{font-size:1rem}.stats{display:none}.filter-system{padding:10px 16px}.filter-row{gap:8px}.filter-row-secondary{gap:10px;flex-direction:column;align-items:stretch}.category-btn{padding:6px 12px;font-size:12px}.filter-search{min-width:100%;order:-1}.volume-filter{min-width:100%;order:0}.sort-controls{margin-left:auto}.coin-symbol-large{font-size:2rem}.price-display{font-size:2.2rem}.modal-stats-grid{grid-template-columns:1fr}.modal-actions{grid-template-columns:1fr}.diver-group.bull{left:8%;top:30%}.diver-group.bear{right:8%;top:70%}.diver-group.bull .diver-circle:nth-child(4),.diver-group.bear .diver-circle:nth-child(4){display:none}.geo-shape{transform:scale(.8)}.alert-banner{min-width:auto;width:calc(100% - 32px);padding:10px 16px}.geo-shape{display:none}}
@media(min-width:769px){.bottom-nav{display:none}.main-content{padding-bottom:20px}.enhanced-modal{align-items:center;padding:20px}.enhanced-modal-content{border-radius:24px;max-height:85vh}}
@media(min-width:1024px){:root{--header-height:70px}.logo{font-size:1.2rem}}
@media(prefers-reduced-motion:reduce){*,::after,::before{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}
</style></head><body data-theme="dark">
<div class="bg-system-wrapper"><div class="bg-layer bg-layer-dark"></div><div class="bg-layer bg-layer-light"></div><div class="bg-particles" id="bg-particles"></div></div>
<div id="divers-container"><div class="diver-group bull"><div class="diver-circle bull"></div><div class="diver-circle bull"></div><div class="diver-circle bull"></div><div class="diver-circle bull"></div></div><div class="diver-group bear"><div class="diver-circle bear"></div><div class="diver-circle bear"></div><div class="diver-circle bear"></div><div class="diver-circle bear"></div></div></div>
<div id="geometric-shapes-container"></div>
<div class="loading-overlay" id="loading-overlay"><div class="loading-spinner"></div><p class="loading-text">ü§ø LOADING FUTURES...</p></div>
<header class="header"><div class="logo"><span>ü§ø</span><span>CRYPTO DIVER</span><span class="futures-badge">üéØ Perps</span></div><div class="header-right"><div class="stats"><div class="stat"><div class="stat-value bullish" id="stat-bullish">0</div><div class="stat-label">Bullish</div></div><div class="stat"><div class="stat-value bearish" id="stat-bearish">0</div><div class="stat-label">Bearish</div></div></div><button class="theme-toggle" id="theme-toggle" title="Toggle theme (T)"><span id="theme-icon">üåô</span></button></div></header>
<div class="filter-system" id="filter-system"><div class="filter-container"><div class="filter-row"><div class="category-filters"><button class="category-btn active" data-category="all">Toate</button><button class="category-btn gainers" data-category="gainers">Gainers ‚ñ≤</button><button class="category-btn losers" data-category="losers">Losers ‚ñº</button><button class="category-btn" data-category="majors">Majors</button></div><div class="sort-controls"><select class="sort-select" id="sort-select"><option value="volume">Volum</option><option value="change">Change %</option><option value="price">Pre»õ</option><option value="name">Nume</option></select><button class="sort-direction-btn" id="sort-direction">‚Üì</button></div><div class="filter-search"><span class="filter-search-icon">üîç</span><input type="text" class="filter-search-input" id="filter-search" placeholder="CautƒÉ monedƒÉ..." autocomplete="off"><button class="filter-search-clear" id="search-clear">√ó</button></div></div><div class="filter-row-secondary"><div class="volume-filter"><span class="volume-filter-label">üìä Min Volume:</span><div class="volume-slider-wrapper"><input type="range" class="volume-slider" id="volume-slider" min="0" max="8" step="1" value="0"></div><span class="volume-value" id="volume-value">All</span></div><button class="alert-toggle-btn" id="alert-toggle" title="Toggle volume alerts"><span class="bell-icon">üîî</span><span>Alerts</span></button><div class="results-count" id="results-count">0 futures</div></div></div></div>
<div class="alert-banner" id="alert-banner"><span class="alert-icon">‚ö°</span><div class="alert-content"><div class="alert-title" id="alert-title">Alert</div><div class="alert-text" id="alert-text">Something happened!</div></div><button class="alert-close" id="alert-close">√ó</button></div>
<main class="main-content"><div id="bubble-container"></div></main>
<nav class="bottom-nav"><button class="bottom-nav-item active" data-tab="heatmap"><span class="bottom-nav-icon">üåä</span><span>Heatmap</span></button><button class="bottom-nav-item" data-tab="search"><span class="bottom-nav-icon">üîç</span><span>Search</span></button><button class="bottom-nav-item" data-tab="stats"><span class="bottom-nav-icon">üìä</span><span>Stats</span></button><button class="bottom-nav-item" data-tab="settings"><span class="bottom-nav-icon">‚öôÔ∏è</span><span>Settings</span></button></nav>
<div class="enhanced-modal" id="enhanced-modal"><div class="enhanced-modal-content"><div class="modal-swipe-handle"></div><div class="modal-header"><button class="modal-nav prev" id="modal-prev">‚Äπ</button><button class="modal-nav next" id="modal-next">‚Ä∫</button><button class="modal-close-btn" id="modal-close">√ó</button><div class="coin-symbol-large" id="modal-symbol">BTC</div><div class="coin-full-name" id="modal-name">BTCUSDT</div></div><div class="price-section"><div class="price-display" id="modal-price">$0.00</div><div class="price-change-pill" id="modal-change">+0.00%</div></div><div class="sparkline-container"><div class="sparkline-wrapper"><svg class="sparkline-svg" viewBox="0 0 300 60" preserveAspectRatio="none"><defs><linearGradient id="sparklineGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:currentColor;stop-opacity:.3"/><stop offset="100%" style="stop-color:currentColor;stop-opacity:0"/></linearGradient></defs><path class="sparkline-area" id="sparkline-area" d=""></path><path class="sparkline-path" id="sparkline-path" d=""></path><circle class="sparkline-dot" id="sparkline-dot" cx="0" cy="0" r="0"></circle></svg></div></div><div class="modal-stats-grid"><div class="stat-card"><div class="stat-card-label">üìä Volume 24h</div><div class="stat-card-value highlight" id="modal-volume">-</div><div class="volume-bars" id="modal-volume-bars"></div></div><div class="stat-card"><div class="stat-card-label">üìà Turnover 24h</div><div class="stat-card-value highlight" id="modal-turnover">-</div></div><div class="stat-card"><div class="stat-card-label">‚¨ÜÔ∏è High 24h</div><div class="stat-card-value" id="modal-high">-</div></div><div class="stat-card"><div class="stat-card-label">‚¨áÔ∏è Low 24h</div><div class="stat-card-value" id="modal-low">-</div></div><div class="stat-card" style="grid-column:span 2"><div class="stat-card-label">üìç Price Range</div><div class="hl-progress"><div class="hl-progress-bar" id="modal-hl-progress" style="width:50%"></div></div><div class="hl-labels"><span id="modal-hl-low">Low</span><span id="modal-hl-current">Current</span><span id="modal-hl-high">High</span></div></div></div><div class="modal-actions"><button class="action-btn primary" id="btn-trade"><span class="action-icon">üöÄ</span><span class="action-label">Trade</span></button><button class="action-btn" id="btn-copy"><span class="action-icon">üìã</span><span class="action-label">Copy</span></button><button class="action-btn" id="btn-share"><span class="action-icon">üîó</span><span class="action-label">Share</span></button></div></div><div class="modal-toast" id="modal-toast"><span>‚úì</span><span id="toast-message">Copied!</span></div></div>
<script>
(function(){'use strict';
const CONFIG={API_URL:'https://api.bybit.com/v5/market/tickers',UPDATE_INTERVAL:3e4,MAX_BUBBLES:60,VOLUME_SPIKE_THRESHOLD:2,SHAPE_COUNT:75,LOADING_TIMEOUT:8e3,ANIMATION_FPS:30,VOLUME_LEVELS:[0,1e6,5e6,1e7,5e7,1e8,5e8,1e9,5e9],FALLBACK_DATA:[{symbol:'BTC',fullSymbol:'BTCUSDT',price:67543.21,change24h:2.34,volume24h:285e9,turnover24h:192e9,high24h:68200,low24h:65800},{symbol:'ETH',fullSymbol:'ETHUSDT',price:3542.18,change24h:1.87,volume24h:152e9,turnover24h:538e9,high24h:3580.5,low24h:3450.2},{symbol:'SOL',fullSymbol:'SOLUSDT',price:178.92,change24h:5.23,volume24h:42e9,turnover24h:752e8,high24h:182.4,low24h:168.7},{symbol:'XRP',fullSymbol:'XRPUSDT',price:.6234,change24h:-1.25,volume24h:21e9,turnover24h:131e8,high24h:.6345,low24h:.6123},{symbol:'BNB',fullSymbol:'BNBUSDT',price:612.45,change24h:-.52,volume24h:89e8,turnover24h:545e7,high24h:618.9,low24h:605.1},{symbol:'ADA',fullSymbol:'ADAUSDT',price:.5845,change24h:.89,volume24h:68e8,turnover24h:397e7,high24h:.5923,low24h:.5767},{symbol:'AVAX',fullSymbol:'AVAXUSDT',price:42.18,change24h:3.45,volume24h:89e8,turnover24h:375e7,high24h:43.25,low24h:40.65},{symbol:'DOT',fullSymbol:'DOTUSDT',price:8.92,change24h:-2.14,volume24h:42e8,turnover24h:374e7,high24h:9.15,low24h:8.71},{symbol:'LINK',fullSymbol:'LINKUSDT',price:18.45,change24h:4.56,volume24h:62e8,turnover24h:114e8,high24h:18.92,low24h:17.58},{symbol:'MATIC',fullSymbol:'MATICUSDT',price:.7856,change24h:1.23,volume24h:38e8,turnover24h:298e7,high24h:.8023,low24h:.7734}]};
const state={coins:[],filteredCoins:[],currentTheme:'dark',currentModalIndex:-1,volumeHistory:{},isLoading:!0,animationId:null,shapes:[],lastAlertTime:0,filters:{category:'all',sortBy:'volume',sortDesc:!0,search:'',minVolume:0},alertsEnabled:!1,timers:{},rafId:null};
const MAJOR_COINS=new Set(['BTC','ETH','BNB','SOL','XRP','ADA','AVAX','DOT','LINK','MATIC']);
function formatPrice(e){return e>=1e3?e.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}):e>=1?e.toFixed(4):e>=.01?e.toFixed(6):e.toFixed(8)}
function formatNumber(e){return e>=1e9?(e/1e9).toFixed(2)+'B':e>=1e6?(e/1e6).toFixed(2)+'M':e>=1e3?(e/1e3).toFixed(2)+'K':e.toFixed(2)}
function formatVolumeValue(e){return 0===e?'All':e>=1e9?(e/1e9).toFixed(1)+'B':e>=1e6?(e/1e6).toFixed(0)+'M':(e/1e3).toFixed(0)+'K'}
function getBubbleColor(e,t){const o=e>=0;return'dark'===t?o?{primary:'#00ff41',glow:'rgba(0,255,65,.6)',text:'#00ff41'}:{primary:'#ff0040',glow:'rgba(255,0,64,.6)',text:'#ff0040'}:o?{primary:'#2a8a4a',glow:'rgba(42,138,74,.3)',text:'#2a8a4a'}:{primary:'#c54a4a',glow:'rgba(197,74,74,.3)',text:'#c54a4a'}}
function calculateBubbleSize(e,t){const o=Math.log10(e+1)/Math.log10(t+1);return 45+65*o}
function clearTimers(){Object.values(state.timers).forEach(e=>clearTimeout(e)),state.timers={}}
function hideLoading(e=!1){const t=document.getElementById('loading-overlay');t&&(t.style.display='none',t.classList.add('hidden')),state.isLoading=!1}
function startLoadingTimeout(){state.timers.loading=setTimeout(()=>{state.isLoading&&(console.warn('Loading timeout - forcing hide'),hideLoading(!0))},CONFIG.LOADING_TIMEOUT),state.timers.backup=setTimeout(()=>{state.isLoading&&hideLoading()},15e3)}
function applyFilters(){let e=[...state.coins];const t=state.filters;'all'!==t.category&&('gainers'===t.category?e=e.filter(e=>e.change24h>0):'losers'===t.category?e=e.filter(e=>e.change24h<0):'majors'===t.category&&(e=e.filter(e=>MAJOR_COINS.has(e.symbol)))),t.minVolume>0&&(e=e.filter(e=>e.volume24h>=t.minVolume)),t.search&&(e=e.filter(e=>e.symbol.toLowerCase().includes(t.search.toLowerCase()))),e.sort((e,o)=>{let a,n;switch(t.sortBy){case'volume':a=e.volume24h,n=o.volume24h;break;case'change':a=e.change24h,n=o.change24h;break;case'price':a=e.price,n=o.price;break;case'name':a=e.symbol.toLowerCase(),n=o.symbol.toLowerCase();break;default:a=e.volume24h,n=o.volume24h}return a<n?t.sortDesc?1:-1:a>n?t.sortDesc?-1:1:0}),state.filteredCoins=e,updateActiveFiltersDisplay(),updateResultsCount(),renderBubblesWithTransition(e)}
function renderBubblesWithTransition(e){const t=d3.selectAll('.bubble-group');if(0===e.length)return void t.transition().duration(300).style('opacity',0).remove();const o=new Set(e.map(e=>e.symbol)),a=state.filters.search.toLowerCase();t.each(function(e){const t=d3.select(this),n=e.symbol;o.has(n)?(t.classed('dimmed',!1).classed('highlighted',a&&n.toLowerCase().includes(a)),t.transition().duration(300).style('opacity',1)):(t.classed('highlighted',!1).classed('dimmed',!0),t.transition().duration(300).style('opacity',.15))}),t.empty()&&renderBubbles(e)}
function updateActiveFiltersDisplay(){const e=document.getElementById('active-filters'),t=state.filters,o=[];'all'!==t.category&&o.push({type:'category',label:{gainers:'Gainers ‚ñ≤',losers:'Losers ‚ñº',majors:'Majors'}[t.category]}),t.minVolume>0&&o.push({type:'volume',label:`Min Vol: ${formatVolumeValue(t.minVolume)}`}),('volume'!==t.sortBy||!t.sortDesc)&&o.push({type:'sort',label:{volume:'Volum',change:'Change %',price:'Pre»õ',name:'Nume'}[t.sortBy]+(t.sortDesc?' ‚Üì':' ‚Üë')}),t.search&&o.push({type:'search',label:`Search: "${t.search}"`});const a=document.querySelector('.results-count');a&&o.forEach(t=>{const o=document.createElement('div');o.className='filter-chip',o.innerHTML=`<span>${t.label}</span><button class="filter-chip-remove" data-type="${t.type}">√ó</button>`,a.parentNode.insertBefore(o,a),o.querySelector('.filter-chip-remove').addEventListener('click',()=>removeFilter(t.type))}),o.length>0&&(()=>{const t=document.createElement('button');t.className='clear-all-btn',t.textContent='Clear All',t.addEventListener('click',clearAllFilters);const o=document.querySelector('.results-count');o&&o.parentNode.insertBefore(t,o)})()}
function updateResultsCount(){const e=document.getElementById('results-count');e&&(e.textContent=`${state.filteredCoins.length} / ${state.coins.length} futures`)}
function removeFilter(e){switch(e){case'category':state.filters.category='all',document.querySelectorAll('.category-btn').forEach(e=>e.classList.toggle('active','all'===e.dataset.category));break;case'volume':state.filters.minVolume=0,document.getElementById('volume-slider').value=0,document.getElementById('volume-value').textContent='All';break;case'sort':state.filters.sortBy='volume',state.filters.sortDesc=!0,document.getElementById('sort-select').value='volume',document.getElementById('sort-direction').textContent='‚Üì';break;case'search':state.filters.search='',document.getElementById('filter-search').value=''}applyFilters()}
function clearAllFilters(){state.filters={category:'all',sortBy:'volume',sortDesc:!0,search:'',minVolume:0},document.querySelectorAll('.category-btn').forEach(e=>e.classList.toggle('active','all'===e.dataset.category)),document.getElementById('sort-select').value='volume',document.getElementById('sort-direction').textContent='‚Üì',document.getElementById('filter-search').value='',document.getElementById('volume-slider').value=0,document.getElementById('volume-value').textContent='All',applyFilters()}
function setupFilterListeners(){document.querySelectorAll('.category-btn').forEach(e=>{e.addEventListener('click',()=>{document.querySelectorAll('.category-btn').forEach(e=>e.classList.remove('active')),e.classList.add('active'),state.filters.category=e.dataset.category,applyFilters()})}),document.getElementById('sort-select').addEventListener('change',e=>{state.filters.sortBy=e.target.value,applyFilters()}),document.getElementById('sort-direction').addEventListener('click',()=>{state.filters.sortDesc=!state.filters.sortDesc,document.getElementById('sort-direction').textContent=state.filters.sortDesc?'‚Üì':'‚Üë',applyFilters()});const e=document.getElementById('filter-search');let t;e.addEventListener('input',e=>{clearTimeout(t),t=setTimeout(()=>{state.filters.search=e.target.value,applyFilters()},300)}),document.getElementById('search-clear').addEventListener('click',()=>{e.value='',state.filters.search='',applyFilters()});const o=document.getElementById('volume-slider'),a=document.getElementById('volume-value');o&&o.addEventListener('input',()=>{const e=parseInt(o.value),t=CONFIG.VOLUME_LEVELS[e];state.filters.minVolume=t,a.textContent=formatVolumeValue(t),applyFilters()});const n=document.getElementById('alert-toggle');n&&n.addEventListener('click',()=>{state.alertsEnabled=!state.alertsEnabled,n.classList.toggle('active',state.alertsEnabled),showToast(state.alertsEnabled?'üîî Volume alerts ON':'üîï Volume alerts OFF')})}
function initParticles(){const e=document.getElementById('bg-particles'),t=window.matchMedia('(pointer: coarse)').matches?6:15;e.innerHTML='';for(let o=0;o<t;o++){const t=document.createElement('div');t.className='bg-particle';const a=100*Math.random(),n=15*-Math.random()+'s',r=10+10*Math.random()+'s',l=['rgba(0,212,255,.4)','rgba(0,255,0,.3)','rgba(255,51,102,.3)','rgba(184,41,221,.3)'][Math.floor(4*Math.random())];t.style.cssText=`left:${a}%;animation:floatUp ${r} ${n} linear infinite`,t.style.background=l,t.style.boxShadow=`0 0 8px ${l}`,e.appendChild(t)}const o=document.createElement('style');o.textContent='@keyframes floatUp{0%{transform:translateY(100vh) scale(.5);opacity:0}10%{opacity:.6}90%{opacity:.4}100%{transform:translateY(-10vh) scale(1.2);opacity:0}}',document.head.appendChild(o)}
function initGeometricShapes(){const e=document.getElementById('geometric-shapes-container'),t=window.matchMedia('(pointer: coarse)').matches?20:CONFIG.SHAPE_COUNT,o=['square','circle','triangle','diamond','hexagon'],a=['float','pulse','rotate'];e.innerHTML='',state.shapes=[];for(let n=0;n<t;n++){const t=o[Math.floor(Math.random()*o.length)],r=document.createElement('div');r.className=`geo-shape geo-${t} ${a[Math.floor(Math.random()*a.length)]}`,r.dataset.shapeType=t;let l,s=0;do{l=100*Math.random(),s=100*Math.random()}while(s<30&&l>30&&l<70&&++s<10);const i=20+40*Math.random();r.style.cssText=`left:${l}%;top:${s}%;width:${i}px;${'triangle'!==t?`height:${i}px;`:''}animation-delay:${-5*Math.random()}s;animation-duration:${5+5*Math.random()}s;opacity:${.3+.4*Math.random()}`,'triangle'===t&&r.classList.add(Math.random()>.5?'up':'down'),r.addEventListener('click',()=>showToast({square:'üü© Stability in the depths',circle:'üî¥ The cycle of the market',triangle:'üî∫ Momentum direction',diamond:'üíé Hidden treasures',hexagon:'‚¨° Structure of the sea'}[t])),e.appendChild(r),state.shapes.push(r)}}
function checkVolumeSpikes(e){if(!state.alertsEnabled)return[];const t=Date.now(),o=[];return e.forEach(e=>{const a=e.symbol,n=e.volume24h;if(!state.volumeHistory[a])return void(state.volumeHistory[a]={volumes:[n],lastAlert:0});const r=state.volumeHistory[a],l=r.volumes.reduce((e,t)=>e+t,0)/r.volumes.length;if(l>0){const s=n/l;s>=CONFIG.VOLUME_SPIKE_THRESHOLD&&t-r.lastAlert>1e4&&(o.push({symbol:a,ratio:s,volume:n}),r.lastAlert=t)}r.volumes.push(n),r.volumes.length>5&&r.volumes.shift()}),o.forEach((e,t)=>{setTimeout(()=>showVolumeAlert(e),500*t)}),o.length>0}
function showVolumeAlert(e){const t=document.getElementById('alert-banner'),o=document.getElementById('alert-title'),a=document.getElementById('alert-text');o.textContent='üö® VOLUME SPIKE DETECTED',a.textContent=`${e.symbol}: ${e.ratio.toFixed(1)}x avg volume ($${formatNumber(e.volume)})`,t.classList.add('volume-spike','show'),state.timers.alert=setTimeout(()=>{t.classList.remove('show')},5e3)}
function showAlert(e,t='info'){const o=document.getElementById('alert-banner'),a=document.getElementById('alert-title'),n=document.getElementById('alert-text');a.textContent='error'===t?'‚ö†Ô∏è Error':'success'===t?'üî• Success':'‚ÑπÔ∏è Info',n.textContent=e,o.classList.remove('volume-spike'),o.classList.add('show'),state.timers.alert2=setTimeout(()=>{o.classList.remove('show')},4e3)}
function initBubbleSimulation(e){const t=document.getElementById('bubble-container'),o=t.clientWidth,a=Math.max(...e.map(e=>e.volume24h)),n=Math.floor(o/130),r=o/n,l=140;return e.forEach((t,s)=>{const i=s%n,d=Math.floor(s/n),u=30*(Math.random()-.5),p=30*(Math.random()-.5);t.x=i*r+r/2+u,t.y=d*l+l/2+p+50,t.vx=0,t.vy=0,t.size=calculateBubbleSize(t.volume24h,a),t.mass=t.size/10,t.gridX=t.x,t.gridY=t.y}),e}
let lastPhysicsTime=0;
function runPhysicsStep(e){const t=performance.now();if(t-lastPhysicsTime<1e3/CONFIG.ANIMATION_FPS)return;lastPhysicsTime=t;const o=2e3,a=.01,n=.9,r=.005,l=document.getElementById('bubble-container'),s=l.clientWidth/2,i=l.clientHeight/2;e.forEach((l,d)=>{let u=0,p=0;e.forEach((e,t)=>{if(d===t)return;const o=l.x-e.x,a=l.y-e.y,n=Math.sqrt(o*o+a*a),r=(l.size+e.size)/2+10;if(n<r&&n>0){const l=2e3*(r-n)/r;u+=o/n*l,p+=a/n*l}}),u+=(l.gridX-l.x)*a,p+=(l.gridY-l.y)*a,u+=(s-l.x)*r*.1,p+=(i-l.y)*r*.1,l.vx=(l.vx+u/l.mass)*n,l.vy=(l.vy+p/l.mass)*n,l.x+=l.vx,l.y+=l.vy;const c=l.size/2+20;l.x=Math.max(c,Math.min(2*s-c,l.x)),l.y=Math.max(c,Math.min(2*i-c,l.y))})}
function renderBubbles(e){const t=document.getElementById('bubble-container'),o=t.clientWidth,a=15*e.length+200,n=Math.max(a,800);t.innerHTML='',t.style.height=n+'px';const r=d3.select('#bubble-container').append('svg').attr('width',o).attr('height',n),l=r.append('defs'),s=l.append('filter').attr('id','glow').attr('x','-50%').attr('y','-50%').attr('width','200%').attr('height','200%');s.append('feGaussianBlur').attr('stdDeviation','4').attr('result','coloredBlur'),s.append('feMerge').append('feMergeNode').attr('in','coloredBlur'),s.select('feMerge').append('feMergeNode').attr('in','SourceGraphic'),initBubbleSimulation(e);const i=r.selectAll('.bubble-group').data(e).enter().append('g').attr('class','bubble-group').attr('data-symbol',e=>e.symbol).attr('transform',e=>`translate(${e.x},${e.y})`).style('opacity',0);i.each(function(e){const t=d3.select(this),o=getBubbleColor(e.change24h,state.currentTheme);t.append('circle').attr('r',e.size/2+8).attr('fill',o.glow).attr('opacity',.3).attr('filter','url(#glow)'),t.append('circle').attr('class','bubble-spiral').attr('r',e.size/2).attr('fill','dark'===state.currentTheme?'rgba(10,10,15,.9)':'rgba(255,255,255,.9)').attr('stroke',o.primary).attr('stroke-width',2).style('color',o.primary),t.append('circle').attr('r',e.size/2-5).attr('fill','none').attr('stroke',o.primary).attr('stroke-width',1).attr('opacity',.3),t.append('text').attr('class','bubble-label').attr('dy','-0.2em').text(e.symbol),t.append('text').attr('class','bubble-change').attr('dy','1.2em').style('fill',o.text).text(`${e.change24h>=0?'+':''}${e.change24h.toFixed(1)}%`)}),i.transition().duration(600).delay((e,t)=>30*t).ease(d3.easeBackOut).style('opacity',1),i.on('click',function(e,t){const o=d3.select(this);o.classed('spinning',!0),state.timers.spin=setTimeout(()=>o.classed('spinning',!1),1e3),openModal(t)});let d=0;!function animate(){d++,d%2==0&&runPhysicsStep(e),i.attr('transform',e=>`translate(${e.x.toFixed(1)},${e.y.toFixed(1)})`),state.rafId=requestAnimationFrame(animate)}()}
function openModal(e){state.currentModalIndex=state.coins.findIndex(t=>t.symbol===e.symbol),updateModalContent(e),document.getElementById('enhanced-modal').classList.add('active'),document.body.style.overflow='hidden',generateSparkline(e)}
function closeModal(){document.getElementById('enhanced-modal').classList.remove('active'),document.body.style.overflow='',clearTimers()}
function updateModalContent(e){const t=e.change24h>=0;document.getElementById('modal-symbol').textContent=e.symbol,document.getElementById('modal-name').textContent=e.fullSymbol||e.symbol,document.getElementById('modal-price').textContent='$'+formatPrice(e.price);const o=document.getElementById('modal-change');o.textContent=`${t?'+':''}${e.change24h.toFixed(2)}%`,o.className='price-change-pill '+(t?'positive':'negative'),document.getElementById('modal-volume').textContent='$'+formatNumber(e.volume24h),document.getElementById('modal-turnover').textContent='$'+formatNumber(e.turnover24h),document.getElementById('modal-high').textContent='$'+formatPrice(e.high24h),document.getElementById('modal-low').textContent='$'+formatPrice(e.low24h);const a=e.high24h-e.low24h,n=((e.price-e.low24h)/a)*100;document.getElementById('modal-hl-progress').style.width=Math.max(5,Math.min(95,n))+'%',document.getElementById('modal-hl-low').textContent='$'+formatNumber(e.low24h),document.getElementById('modal-hl-high').textContent='$'+formatNumber(e.high24h),document.getElementById('modal-hl-current').textContent=formatNumber(e.price),generateVolumeBars(),document.getElementById('modal-prev').disabled=state.currentModalIndex<=0,document.getElementById('modal-next').disabled=state.currentModalIndex>=state.coins.length-1}
function generateSparkline(e){const t=[],o=e?e.change24h/100:0;let a=e?e.price:100;for(let n=0;n<50;n++)t.unshift(a),a*=1+.5*(Math.random()-.5)*.04+-o/50;const n=Math.min(...t),r=Math.max(...t),l=r-n||1,s=t.map((e,t)=>{const o=t/49*300,a=55-((e-n)/l)*50;return[o,a]}),i=s.map((e,t)=>(0===t?'M':'L')+e[0]+','+e[1]).join(' '),d=i+' L300,60 L0,60 Z',u=e?e.change24h>=0:!0,p=u?'#00ff41':'#ff0040';document.getElementById('sparkline-path').setAttribute('d',i),document.getElementById('sparkline-area').setAttribute('d',d),document.getElementById('sparkline-path').setAttribute('stroke',p);const c=s[s.length-1],m=document.getElementById('sparkline-dot');m.setAttribute('cx',c[0]),m.setAttribute('cy',c[1]),m.setAttribute('r',4),m.setAttribute('fill',p);const f=document.getElementById('sparkline-path');f.style.strokeDasharray=300,f.style.strokeDashoffset=300,f.getBoundingClientRect(),f.style.animation='drawLine 1s ease-out forwards'}
function generateVolumeBars(){const e=document.getElementById('modal-volume-bars');e.innerHTML='';for(let t=0;t<12;t++){const t=document.createElement('div');t.className='volume-bar-mini',t.style.height=20+80*Math.random()+'%',t.style.opacity=.4+.05*t,e.appendChild(t)}}
function navigateModal(e){const t=state.currentModalIndex+e;t>=0&&t<state.coins.length&&(state.currentModalIndex=t,updateModalContent(state.coins[t]),generateSparkline(state.coins[t]))}
function showToast(e){const t=document.getElementById('modal-toast');document.getElementById('toast-message').textContent=e,t.classList.add('show'),state.timers.toast=setTimeout(()=>{t.classList.remove('show')},2500)}
async function fetchMarketData(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),5e3),o=await fetch(`${CONFIG.API_URL}?category=linear`,{signal:e.signal});if(clearTimeout(t),!o.ok)throw new Error('HTTP error');const a=await o.json();if(0!==a.retCode)throw new Error(a.retMsg);return processMarketData(a.result.list)}catch(e){return console.warn('API failed:',e.message),null}}
function processMarketData(e){return e.filter(e=>e.symbol.endsWith('USDT')).map(e=>({symbol:e.symbol.replace('USDT',''),fullSymbol:e.symbol,price:parseFloat(e.lastPrice)||0,change24h:100*(parseFloat(e.price24hPcnt)||0),volume24h:parseFloat(e.volume24h)||0,turnover24h:parseFloat(e.turnover24h)||0,high24h:parseFloat(e.highPrice24h)||0,low24h:parseFloat(e.lowPrice24h)||0})).filter(e=>e.price>0).sort((e,t)=>t.volume24h-e.volume24h).slice(0,CONFIG.MAX_BUBBLES)}
function updateStats(e){const t=e.filter(e=>e.change24h>0).length,o=e.filter(e=>e.change24h<0).length;document.getElementById('stat-bullish').textContent=t,document.getElementById('stat-bearish').textContent=o}
function toggleTheme(){const e='dark'===state.currentTheme?'light':'dark';state.currentTheme=e,document.body.setAttribute('data-theme',e),document.getElementById('theme-icon').textContent='dark'===e?'üåô':'‚òÄÔ∏è',state.coins.length>0&&(cancelAnimationFrame(state.rafId),renderBubbles(state.filteredCoins.length>0?state.filteredCoins:state.coins));try{localStorage.setItem('bybit-heatmap-theme',e)}catch(e){}}
function loadTheme(){let e='dark';try{e=localStorage.getItem('bybit-heatmap-theme')||'dark'}catch(e){}state.currentTheme=e,document.body.setAttribute('data-theme',e),document.getElementById('theme-icon').textContent='dark'===e?'üåô':'‚òÄÔ∏è'}
function setupEventListeners(){document.getElementById('theme-toggle').addEventListener('click',toggleTheme),document.getElementById('modal-close').addEventListener('click',closeModal),document.getElementById('enhanced-modal').addEventListener('click',e=>{'enhanced-modal'===e.target.id&&closeModal()}),document.getElementById('modal-prev').addEventListener('click',()=>navigateModal(-1)),document.getElementById('modal-next').addEventListener('click',()=>navigateModal(1)),document.getElementById('btn-trade').addEventListener('click',()=>{const e=state.coins[state.currentModalIndex];e&&window.open(`https://www.bybit.com/trade/usdt/${e.symbol}USDT`,'_blank')}),document.getElementById('btn-copy').addEventListener('click',async()=>{const e=state.coins[state.currentModalIndex];if(e){const t=`${e.symbol}: $${formatPrice(e.price)} (${e.change24h>=0?'+':''}${e.change24h.toFixed(2)}%)`;try{await navigator.clipboard.writeText(t),showToast('Price copied!')}catch(e){showToast('Copy failed')}}}),document.getElementById('btn-share').addEventListener('click',async()=>{const e=state.coins[state.currentModalIndex];if(e){const t={title:`${e.symbol} on Bybit`,text:`${e.symbol}: $${formatPrice(e.price)} (${e.change24h>=0?'+':''}${e.change24h.toFixed(2)}%)`,url:`https://www.bybit.com/trade/usdt/${e.symbol}USDT`};try{navigator.share?await navigator.share(t):(await navigator.clipboard.writeText(`${t.text} - ${t.url}`),showToast('Link copied!'))}catch(e){'AbortError'!==e.name&&showToast('Share failed')}}}),document.getElementById('alert-close').addEventListener('click',()=>document.getElementById('alert-banner').classList.remove('show')),document.addEventListener('keydown',e=>{if('Escape'===e.key)closeModal();else if('ArrowLeft'===e.key){const t=document.getElementById('enhanced-modal');t&&t.classList.contains('active')&&navigateModal(-1)}else if('ArrowRight'===e.key){const t=document.getElementById('enhanced-modal');t&&t.classList.contains('active')&&navigateModal(1)}else if(('t'===e.key||'T'===e.key)&&'INPUT'!==e.target.tagName)toggleTheme();else if(('s'===e.key||'S'===e.key)&&'INPUT'!==e.target.tagName){e.preventDefault(),document.getElementById('filter-search').focus()}});let e=0;const t=document.querySelector('.enhanced-modal-content');t&&(t.addEventListener('touchstart',t=>{e=t.touches[0].clientY},{passive:!0}),t.addEventListener('touchend',t=>{t.changedTouches[0].clientY-e>100&&closeModal()},{passive:!0}));let o;window.addEventListener('resize',()=>{clearTimeout(o),o=setTimeout(()=>{state.coins.length>0&&(cancelAnimationFrame(state.rafId),renderBubbles(state.filteredCoins.length>0?state.filteredCoins:state.coins))},250)})}
async function init(){console.log('ü§ø CRYPTO DIVER v6 - Futures Perpetual Heatmap'),state.isLoading=!0,startLoadingTimeout(),loadTheme(),initParticles(),initGeometricShapes(),setupEventListeners(),setupFilterListeners();let e=null,t=!1;try{e=await fetchMarketData(),e||(e=[...CONFIG.FALLBACK_DATA],t=!0)}catch(o){console.error('Init error:',o),e=[...CONFIG.FALLBACK_DATA],t=!0}e&&e.length>0?(state.coins=e,state.filteredCoins=e,hideLoading(t),renderBubbles(e),updateStats(e),applyFilters(),t||checkVolumeSpikes(e),console.log(`‚úÖ ${e.length} futures${t?' (fallback)':''}`),t||(state.timers.refresh=setInterval(async()=>{const e=await fetchMarketData();e&&(state.coins=e,applyFilters(),checkVolumeSpikes(e))},CONFIG.UPDATE_INTERVAL))):(console.error('No data'),hideLoading(!0),showAlert('Failed to load data','error'))}
'loading'===document.readyState?document.addEventListener('DOMContentLoaded',init):init();
})();
</script></body></html>