<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BYBIT HEATMAP | Cyberpunk Edition ðŸ’°</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { 
            --neon-green: #00ff41; --neon-green-glow: rgba(0, 255, 65, 0.5);
            --neon-red: #ff0040; --neon-red-glow: rgba(255, 0, 64, 0.5);
            --accent-gold: #ffd700; --bg-dark: #050508; --bg-mid: #0a0a0f;
        }
        html, body { 
            font-family: 'Rajdhani', sans-serif; 
            background: var(--bg-dark); 
            min-height: 100vh; 
            color: #fff;
            overflow-x: hidden;
        }
        
        /* Cyberpunk Grid Background */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: 
                linear-gradient(90deg, rgba(0, 255, 65, 0.04) 1px, transparent 1px),
                linear-gradient(rgba(0, 255, 65, 0.04) 1px, transparent 1px),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 0, 64, 0.03) 2px, rgba(255, 0, 64, 0.03) 4px),
                radial-gradient(ellipse at 30% 20%, rgba(0, 255, 65, 0.08) 0%, transparent 40%),
                radial-gradient(ellipse at 70% 80%, rgba(255, 0, 64, 0.08) 0%, transparent 40%),
                var(--bg-dark);
            background-size: 80px 80px, 80px 80px, 100% 100%, 100% 100%, 100% 100%, 100% 100%;
            animation: bgShift 20s ease-in-out infinite;
            z-index: -2;
        }
        @keyframes bgShift { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        
        /* Scan Line Effect */
        .scan-line { 
            position: fixed; top: 0; left: 0; right: 0; height: 3px; 
            background: linear-gradient(90deg, transparent, var(--neon-green), var(--accent-gold), var(--neon-green), transparent);
            opacity: 0.4; animation: scanDown 4s linear infinite; pointer-events: none; z-index: 1000;
            box-shadow: 0 0 20px var(--neon-green);
        }
        @keyframes scanDown { 0% { top: -3px; opacity: 0; } 10% { opacity: 0.4; } 90% { opacity: 0.4; } 100% { top: 100vh; opacity: 0; } }
        
        /* Particle Canvas */
        #particles-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        
        /* Header */
        .header { 
            position: fixed; top: 0; left: 0; right: 0; padding: 14px 20px; 
            background: linear-gradient(180deg, rgba(5,5,8,0.98), rgba(10,10,15,0.9) 50%, transparent);
            z-index: 100; display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(15px); border-bottom: 1px solid rgba(0, 255, 65, 0.15);
            box-shadow: 0 4px 30px rgba(0, 255, 65, 0.1);
        }
        .logo { 
            font-family: 'Orbitron', sans-serif; font-size: 1.3rem; font-weight: 900; 
            letter-spacing: 4px; background: linear-gradient(135deg, #fff, var(--accent-gold), #fff);
            background-size: 200% 200%; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes shimmer { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        
        .header-controls { display: flex; gap: 10px; align-items: center; }
        .filter-btn { 
            background: rgba(0, 255, 65, 0.08); border: 1px solid rgba(0, 255, 65, 0.3); 
            color: var(--neon-green); padding: 8px 16px; border-radius: 25px; 
            font-family: 'Rajdhani', sans-serif; font-size: 0.8rem; font-weight: 600; 
            cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1.5px;
        }
        .filter-btn:hover, .filter-btn.active { 
            background: rgba(0, 255, 65, 0.25); box-shadow: 0 0 20px rgba(0, 255, 65, 0.4); 
            transform: translateY(-2px);
        }
        .journal-btn { background: rgba(255, 215, 0, 0.15); border-color: rgba(255, 215, 0, 0.4); color: var(--accent-gold); }
        .journal-btn:hover, .journal-btn.active { background: rgba(255, 215, 0, 0.3); box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
        
        .last-update { font-size: 0.8rem; color: rgba(255,255,255,0.6); display: flex; align-items: center; gap: 8px; }
        .update-dot { 
            width: 10px; height: 10px; background: var(--neon-green); border-radius: 50%;
            animation: pulse 1.5s ease-in-out infinite; box-shadow: 0 0 15px var(--neon-green);
        }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        
        /* Main Container */
        .container { padding-top: 80px; min-height: 100vh; }
        
        /* Stats Bar */
        .stats-bar {
            display: flex; justify-content: center; gap: 40px; padding: 15px;
            background: rgba(0,0,0,0.3); margin: 0 20px 20px; border-radius: 15px;
            border: 1px solid rgba(0, 255, 65, 0.1);
        }
        .stat-box { text-align: center; }
        .stat-value { font-family: 'Orbitron'; font-size: 1.8rem; font-weight: 700; }
        .stat-value.up { color: var(--neon-green); text-shadow: 0 0 20px var(--neon-green-glow); }
        .stat-value.down { color: var(--neon-red); text-shadow: 0 0 20px var(--neon-red-glow); }
        .stat-label { font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; margin-top: 4px; }
        
        /* Bubble Container */
        #bubble-container { width: 100%; min-height: calc(100vh - 200px); position: relative; }
        
        /* Enhanced Bubbles */
        .bubble-group { 
            cursor: pointer; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 15px currentColor);
        }
        .bubble-group:hover { 
            transform: scale(1.15) translateY(-5px); 
            filter: drop-shadow(0 0 30px currentColor) brightness(1.3);
            z-index: 100;
        }
        .bubble-spiral { animation: rotate 20s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .spiral-path { fill: none; stroke-linecap: round; }
        .bubble-label { 
            font-family: 'Orbitron', sans-serif; font-weight: 700; text-anchor: middle; 
            pointer-events: none; fill: #fff; text-shadow: 0 0 15px rgba(0,0,0,0.9), 0 0 30px currentColor;
        }
        .bubble-change { 
            font-family: 'Rajdhani', sans-serif; font-weight: 600; text-anchor: middle; 
            pointer-events: none; fill: #fff; text-shadow: 0 0 10px rgba(0,0,0,0.9);
        }
        
        /* Modal Styles */
        .modal-overlay { 
            position: fixed; inset: 0; background: rgba(5, 5, 8, 0.95);
            backdrop-filter: blur(25px); z-index: 1000; display: none;
            justify-content: center; align-items: flex-end;
        }
        .modal-overlay.active { display: flex; }
        .modal-content { 
            background: linear-gradient(145deg, rgba(15,10,20,0.98), rgba(8,8,12,0.99));
            border-radius: 30px 30px 0 0; padding: 30px 24px 50px; width: 100%;
            max-width: 500px; max-height: 90vh; border-top: 3px solid;
            border-image: linear-gradient(90deg, var(--neon-green), var(--neon-red)) 1;
            animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow-y: auto;
        }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-handle { 
            width: 60px; height: 5px; background: linear-gradient(90deg, rgba(0,255,65,0.6), rgba(255,0,64,0.6));
            border-radius: 3px; margin: 0 auto 25px;
        }
        .coin-header { text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .coin-symbol { font-family: 'Orbitron', sans-serif; font-size: 2.4rem; font-weight: 900; letter-spacing: 4px; }
        .coin-change { font-family: 'Orbitron', sans-serif; font-size: 3rem; font-weight: 700; margin-top: 12px; text-shadow: 0 0 40px currentColor; }
        .coin-change.positive { color: var(--neon-green); }
        .coin-change.negative { color: var(--neon-red); }
        
        .chart-container { width: 100%; height: 200px; margin: 20px 0; background: rgba(255,255,255,0.03); border-radius: 16px; padding: 15px; border: 1px solid rgba(255,255,255,0.08); }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .stat-item { background: rgba(255,255,255,0.04); padding: 18px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; }
        .stat-item:hover { background: rgba(255,255,255,0.06); border-color: rgba(0, 255, 65, 0.3); transform: translateY(-2px); }
        .stat-item-label { font-size: 0.7rem; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
        .stat-item-value { font-family: 'Orbitron', sans-serif; font-size: 1.1rem; font-weight: 600; color: #fff; }
        
        /* Trading Journal Styles */
        .journal-modal .modal-content { border-top-color: var(--accent-gold); border-image: linear-gradient(90deg, var(--accent-gold), var(--neon-green)) 1; }
        .journal-title { font-family: 'Orbitron'; font-size: 1.8rem; text-align: center; margin-bottom: 20px; color: var(--accent-gold); }
        .trade-form { display: flex; flex-direction: column; gap: 15px; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-label { font-size: 0.8rem; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 1px; }
        .form-input {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px; padding: 12px 15px; color: #fff; font-size: 1rem;
            font-family: 'Rajdhani', sans-serif;
        }
        .form-input:focus { border-color: var(--accent-gold); outline: none; box-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .trade-type-buttons { display: flex; gap: 10px; }
        .trade-type-btn {
            flex: 1; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05); color: #fff; font-family: 'Orbitron';
            cursor: pointer; transition: all 0.3s;
        }
        .trade-type-btn.long { border-color: rgba(0,255,65,0.4); }
        .trade-type-btn.long.active { background: rgba(0,255,65,0.2); border-color: var(--neon-green); }
        .trade-type-btn.short { border-color: rgba(255,0,64,0.4); }
        .trade-type-btn.short.active { background: rgba(255,0,64,0.2); border-color: var(--neon-red); }
        .submit-btn {
            background: linear-gradient(135deg, var(--accent-gold), #ffed4e);
            color: #000; padding: 15px; border-radius: 25px; border: none;
            font-family: 'Orbitron'; font-weight: 700; font-size: 1rem;
            cursor: pointer; margin-top: 10px;
        }
        .trades-list { margin-top: 20px; max-height: 300px; overflow-y: auto; }
        .trade-item {
            background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px;
            margin-bottom: 10px; border-left: 3px solid;
        }
        .trade-item.long { border-left-color: var(--neon-green); }
        .trade-item.short { border-left-color: var(--neon-red); }
        .trade-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .trade-symbol { font-family: 'Orbitron'; font-weight: 700; }
        .trade-pnl { font-family: 'Orbitron'; font-weight: 700; }
        .trade-pnl.positive { color: var(--neon-green); }
        .trade-pnl.negative { color: var(--neon-red); }
        .trade-details { font-size: 0.85rem; color: rgba(255,255,255,0.6); }
        
        @media (max-width: 768px) { 
            .header { padding: 12px 15px; } 
            .logo { font-size: 1rem; letter-spacing: 2px; }
            .filter-btn { padding: 6px 12px; font-size: 0.7rem; }
            .stats-bar { gap: 20px; padding: 12px; }
            .stat-value { font-size: 1.4rem; }
            .coin-symbol { font-size: 1.8rem; }
            .coin-change { font-size: 2.2rem; }
            .chart-container { height: 150px; }
        }
    </style>
</head>
<body>
    <div class="scan-line"></div>
    <canvas id="particles-canvas"></canvas>
    
    <div class="header">
        <div class="logo">ðŸ’° BYBIT</div>
        <div class="header-controls">
            <button class="filter-btn" onclick="showJournal()">ðŸ““ JOURNAL</button>
            <button class="filter-btn active" onclick="setSort('change')" id="btn-change">% CHANGE</button>
            <button class="filter-btn" onclick="setSort('volume')" id="btn-volume">VOLUME</button>
            <button class="filter-btn" onclick="setSort('alpha')" id="btn-alpha">A-Z</button>
        </div>
        <div class="last-update">
            <span class="update-dot"></span>
            <span id="update-time">--:--</span>
        </div>
    </div>
    
    <div class="container">
        <div class="stats-bar">
            <div class="stat-box">
                <div class="stat-value up" id="total-gainers">--</div>
                <div class="stat-label">Gainers</div>
            </div>
            <div class="stat-box">
                <div class="stat-value down" id="total-losers">--</div>
                <div class="stat-label">Losers</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="market-sentiment" style="color: var(--accent-gold);">--</div>
                <div class="stat-label">Sentiment</div>
            </div>
        </div>
        
        <div id="bubble-container"></div>
    </div>
    
    <!-- Coin Detail Modal -->
    <div class="modal-overlay" id="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-handle"></div>
            <div class="coin-header">
                <div class="coin-symbol" id="modal-symbol">BTC</div>
                <div class="coin-change" id="modal-change">+5.23%</div>
            </div>
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
            <div class="stats-grid">
                <div class="stat-item"><div class="stat-item-label">PreÈ›</div><div class="stat-item-value" id="modal-price">-</div></div>
                <div class="stat-item"><div class="stat-item-label">Volum 24h</div><div class="stat-item-value" id="modal-volume">-</div></div>
                <div class="stat-item"><div class="stat-item-label">Max 24h</div><div class="stat-item-value" id="modal-high">-</div></div>
                <div class="stat-item"><div class="stat-item-label">Min 24h</div><div class="stat-item-value" id="modal-low">-</div></div>
            </div>
            <button class="filter-btn" style="margin-top: 20px; width: 100%;" onclick="addToJournal()">âž• Add to Journal</button>
        </div>
    </div>
    
    <!-- Trading Journal Modal -->
    <div class="modal-overlay journal-modal" id="journal-modal" onclick="closeJournal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-handle"></div>
            <div class="journal-title">ðŸ““ TRADING JOURNAL</div>
            
            <div class="trade-form">
                <div class="form-group">
                    <label class="form-label">Symbol</label>
                    <input type="text" class="form-input" id="trade-symbol" placeholder="BTC">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Trade Type</label>
                    <div class="trade-type-buttons">
                        <button type="button" class="trade-type-btn long" onclick="setTradeType('long')">ðŸ“ˆ LONG</button>
                        <button type="button" class="trade-type-btn short" onclick="setTradeType('short')">ðŸ“‰ SHORT</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Entry Price</label>
                    <input type="number" class="form-input" id="trade-entry" placeholder="45000">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Exit Price</label>
                    <input type="number" class="form-input" id="trade-exit" placeholder="48000">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Position Size ($)</label>
                    <input type="number" class="form-input" id="trade-size" placeholder="1000">
                </div>
                
                <button class="submit-btn" onclick="submitTrade()">ðŸ’¾ Save Trade</button>
            </div>
            
            <div class="trades-list" id="trades-list"></div>
        </div>
    </div>

    <script>
        // Global state
        let bubbleData = [], currentSort = 'change', currentModalCoin = null, trades = [];
        let tradeType = 'long';
        
        // Load trades from localStorage
        function loadTrades() {
            const saved = localStorage.getItem('trading-journal');
            if (saved) trades = JSON.parse(saved);
            renderTrades();
        }
        
        // Save trades to localStorage
        function saveTrades() {
            localStorage.setItem('trading-journal', JSON.stringify(trades));
        }
        
        // Particle system
        const canvas = document.getElementById('particles-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 0.5;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.color = Math.random() > 0.5 ? 'rgba(0, 255, 65, ' : 'rgba(255, 0, 64, ';
                this.alpha = Math.random() * 0.5 + 0.1;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) this.reset();
            }
            draw() {
                ctx.fillStyle = this.color + this.alpha + ')';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        for (let i = 0; i < 80; i++) particles.push(new Particle());
        
        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();
        
        // Load data from Bybit
        async function loadData() {
            try {
                const res = await fetch('https://api.bybit.com/v5/market/tickers?category=linear');
                const json = await res.json();
                
                if (json.retCode !== 0) throw new Error(json.retMsg);
                
                bubbleData = json.result.list
                    .filter(i => i.symbol.endsWith('USDT'))
                    .map(i => ({
                        symbol: i.symbol.replace('USDT', ''),
                        change24h: parseFloat(i.price24hPcnt) * 100,
                        price: parseFloat(i.lastPrice),
                        volume24h: parseFloat(i.volume24h) * parseFloat(i.lastPrice),
                        high24h: parseFloat(i.highPrice24h),
                        low24h: parseFloat(i.lowPrice24h)
                    }))
                    .filter(i => !isNaN(i.change24h) && i.price > 0)
                    .sort((a, b) => Math.abs(b.change24h) - Math.abs(a.change24h))
                    .slice(0, 60);
                
                updateStats();
                renderBubbles();
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }
        
        function updateStats() {
            const gainers = bubbleData.filter(d => d.change24h >= 0).length;
            const losers = bubbleData.filter(d => d.change24h < 0).length;
            const sentiment = gainers > losers ? 'BULLISH ðŸ“ˆ' : gainers < losers ? 'BEARISH ðŸ“‰' : 'NEUTRAL âš–ï¸';
            
            document.getElementById('total-gainers').textContent = gainers;
            document.getElementById('total-losers').textContent = losers;
            document.getElementById('market-sentiment').textContent = sentiment;
            document.getElementById('update-time').textContent = new Date().toLocaleTimeString('ro-RO');
        }
        
        function setSort(type) {
            currentSort = type;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + type).classList.add('active');
            
            if (type === 'change') bubbleData.sort((a, b) => Math.abs(b.change24h) - Math.abs(a.change24h));
            else if (type === 'volume') bubbleData.sort((a, b) => b.volume24h - a.volume24h);
            else if (type === 'alpha') bubbleData.sort((a, b) => a.symbol.localeCompare(b.symbol));
            
            renderBubbles();
        }
        
        function getColor(c) { return c >= 0 ? '#00ff41' : '#ff0040'; }
        
        function renderBubbles() {
            const w = window.innerWidth, container = document.getElementById('bubble-container');
            container.innerHTML = '';
            
            const centerX = w / 2, centerY = 300, isMobile = w < 768;
            
            bubbleData.forEach((d, i) => {
                const angle = i * 2.4;
                const radius = 80 + Math.sqrt(i) * (isMobile ? 22 : 30);
                const x = centerX + Math.cos(angle) * radius + (Math.random() - 0.5) * 40;
                const y = centerY + Math.sin(angle) * radius * 0.6 + (Math.random() - 0.5) * 30;
                const size = (isMobile ? 40 : 50) + Math.min(Math.abs(d.change24h) / 15, 1) * 15;
                const col = getColor(d.change24h);
                
                const bubble = document.createElement('div');
                bubble.className = 'bubble-group';
                bubble.style.cssText = `position:absolute;left:${x - size/2}px;top:${y - size/2}px;width:${size}px;height:${size}px;`;
                bubble.onclick = () => showModal(d);
                
                // SVG bubble
                bubble.innerHTML = `
                    <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" style="overflow:visible">
                        <circle cx="${size/2}" cy="${size/2}" r="${size/2 + 8}" fill="${col}" opacity="0.1" />
                        <circle cx="${size/2}" cy="${size/2}" r="${size/2 - 2}" stroke="${col}" stroke-width="2" fill="none" opacity="0.6" />
                        <circle cx="${size/2}" cy="${size/2}" r="${size/2 - 10}" stroke="${col}" stroke-width="1.5" fill="none" opacity="0.4" />
                        <circle cx="${size/2}" cy="${size/2}" r="${size/4}" fill="${col}" opacity="0.3" />
                        <text x="${size/2}" y="${size/2 - 3}" text-anchor="middle" fill="#fff" font-size="${size/3.5}" font-weight="bold" font-family="Orbitron">${d.symbol}</text>
                        <text x="${size/2}" y="${size/2 + 10}" text-anchor="middle" fill="${col}" font-size="${size/5}" font-weight="600" font-family="Rajdhani">${d.change24h >= 0 ? '+' : ''}${d.change24h.toFixed(1)}%</text>
                    </svg>
                `;
                
                container.appendChild(bubble);
            });
        }
        
        function showModal(d) {
            currentModalCoin = d;
            document.getElementById('modal-symbol').textContent = d.symbol;
            const ce = document.getElementById('modal-change');
            ce.textContent = (d.change24h >= 0 ? '+' : '') + d.change24h.toFixed(2) + '%';
            ce.className = 'coin-change ' + (d.change24h >= 0 ? 'positive' : 'negative');
            document.getElementById('modal-price').textContent = '$' + d.price.toFixed(4);
            document.getElementById('modal-volume').textContent = '$' + (d.volume24h / 1e6).toFixed(2) + 'M';
            document.getElementById('modal-high').textContent = '$' + d.high24h.toFixed(4);
            document.getElementById('modal-low').textContent = '$' + d.low24h.toFixed(4);
            document.getElementById('modal').classList.add('active');
            
            // Fill journal with current coin
            document.getElementById('trade-symbol').value = d.symbol;
        }
        
        function closeModal(e) {
            if (!e || e.target === document.getElementById('modal')) {
                document.getElementById('modal').classList.remove('active');
            }
        }
        
        // Journal functions
        function showJournal() {
            document.getElementById('journal-modal').classList.add('active');
        }
        
        function closeJournal(e) {
            if (!e || e.target === document.getElementById('journal-modal')) {
                document.getElementById('journal-modal').classList.remove('active');
            }
        }
        
        function setTradeType(type) {
            tradeType = type;
            document.querySelectorAll('.trade-type-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.trade-type-btn.' + type).classList.add('active');
        }
        
        function addToJournal() {
            closeModal();
            showJournal();
        }
        
        function submitTrade() {
            const symbol = document.getElementById('trade-symbol').value.toUpperCase();
            const entry = parseFloat(document.getElementById('trade-entry').value);
            const exit = parseFloat(document.getElementById('trade-exit').value);
            const size = parseFloat(document.getElementById('trade-size').value);
            
            if (!symbol || !entry || !exit || !size) {
                alert('Complete all fields!');
                return;
            }
            
            const pnl = tradeType === 'long' 
                ? ((exit - entry) / entry) * size 
                : ((entry - exit) / entry) * size;
            
            const trade = {
                id: Date.now(),
                symbol,
                type: tradeType,
                entry,
                exit,
                size,
                pnl,
                date: new Date().toLocaleString('ro-RO')
            };
            
            trades.unshift(trade);
            saveTrades();
            renderTrades();
            
            // Clear form
            document.getElementById('trade-symbol').value = '';
            document.getElementById('trade-entry').value = '';
            document.getElementById('trade-exit').value = '';
            document.getElementById('trade-size').value = '';
            
            alert('Trade saved! P&L: $' + pnl.toFixed(2));
        }
        
        function renderTrades() {
            const list = document.getElementById('trades-list');
            if (trades.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:rgba(255,255,255,0.5);padding:20px;">No trades yet</div>';
                return;
            }
            
            list.innerHTML = trades.map(t => `
                <div class="trade-item ${t.type}">
                    <div class="trade-header">
                        <span class="trade-symbol">${t.symbol} ${t.type === 'long' ? 'ðŸ“ˆ' : 'ðŸ“‰'}</span>
                        <span class="trade-pnl ${t.pnl >= 0 ? 'positive' : 'negative'}">
                            ${t.pnl >= 0 ? '+' : ''}$${t.pnl.toFixed(2)}
                        </span>
                    </div>
                    <div class="trade-details">
                        Entry: $${t.entry} â†’ Exit: $${t.exit} | Size: $${t.size}<br>
                        ${t.date}
                    </div>
                </div>
            `).join('');
        }
        
        // Keyboard nav
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeJournal();
            }
        });
        
        // Init
        loadData();
        loadTrades();
        setInterval(loadData, 30000);
        setTradeType('long');
    </script>
</body>
</html>
</body>
</html>